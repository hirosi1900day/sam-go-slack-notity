AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'aws-golang

  Sample SAM Template for aws-golang

  '
Globals:
  Function:
    Timeout: 10
    MemorySize: 128
Resources:
  SLACKHandler:
    Metadata:
      BuildMethod: go1.x
      SamResourceId: SLACKHandler
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: SLACKHandler
      Handler: slack
      Runtime: provided.al2
      Architectures:
      - x86_64
      Events:
        ApiEvent:
          Type: Api
          Properties:
            Path: /hello
            Method: GET
      Environment:
        Variables:
          PARAM1: VALUE
      EventInvokeConfig:
        MaximumRetryAttempts: 0
  AWSHandler:
    Metadata:
      BuildMethod: go1.x
      SamResourceId: AWSHandler
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: AWSHandler
      Handler: aws
      Runtime: provided.al2
      Architectures:
      - x86_64
      Events:
        SQSEvent:
          Type: SQS
          Properties:
            Queue:
              Fn::GetAtt:
              - AWSSqsQueue
              - Arn
      EventInvokeConfig:
        MaximumRetryAttempts: 0
  AWSSqsQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: test-aws.fifo
      FifoQueue: true
      VisibilityTimeout: 300
      RedrivePolicy:
        deadLetterTargetArn:
          Fn::GetAtt:
          - DeadLetterQueue
          - Arn
        maxReceiveCount: 1
  DeadLetterQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: test-dead-letter-queue.fifo
      FifoQueue: true
      VisibilityTimeout: 300
  DynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      - AttributeName: group
        AttributeType: S
      TableName: test-reviewergroup
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      GlobalSecondaryIndexes:
      - IndexName: group-index
        KeySchema:
        - AttributeName: group
          KeyType: HASH
        Projection:
          NonKeyAttributes:
          - user
          ProjectionType: INCLUDE
Outputs:
  AWSAPI:
    Description: API Gateway endpoint URL for Prod environment for First Function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/hello/
  AWSHandler:
    Description: First Lambda Function ARN
    Value:
      Fn::GetAtt:
      - AWSHandler
      - Arn
  AWSHandlerIamRole:
    Description: Implicit IAM Role created for Hello World function
    Value:
      Fn::GetAtt:
      - AWSHandlerRole
      - Arn
